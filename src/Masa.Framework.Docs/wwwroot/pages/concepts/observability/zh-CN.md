# 可观测性

## 概念

### 什么是可观测性？

可观测提供了对现代分布式系统的深入可见性，以便更快、自动地识别和解决问题。

一般而言，可观测性是指您仅根据对复杂系统外部输出的了解就可以了解其内部状态或条件的程度。系统的可观测性越强，您就可以越快、越准确地从已识别的性能问题导航到其根本原因，而无需进行额外的测试或编码。

在 IT 和云计算中，可观测性还指用于聚合、关联和分析来自分布式应用程序及其运行的硬件和网络的稳定性能数据流的软件工具和实践，以便更有效地监控、故障排除和调试应用程序和网络以满足客户体验期望、服务水平协议 (SLA) 和其他业务要求。

### 为什么需要可观测性？

在过去时间里，IT 团队主要依靠`APM`(Application Performance Management)和`NPM`(Network Performance Monitoring)来监控应用程序及其运行的网络并对其进行故障排除。

`APM`对应用程序和系统数据进行定期采样和聚合，称为 "遥测"，与已知的应用程序性能问题有关。它分析与关键绩效指标(KPIs)相关的遥测数据，并将结果汇​​总到仪表板中，以提醒运营和支持团队注意应解决的异常情况，以解决或预防问题。

`APM`对于监视单体应用程序或传统分布式应用程序并对其进行故障排除非常有效，在这些应用程序中，新代码会定期发布，并且应用程序组件、服务器和相关资源之间的工作流和依赖关系是众所周知的或易于跟踪的。

同样，`NPM`从混合网络中收集网络性能指标和流量数据，并分析这些数据，以帮助网络运营和工程团队了解网络性能何时不正常。

`NPM`为组织提供解决网络问题的洞察力，以及规划持续网络性能所需的未来容量所需的数据。

现在企业正在迅速采用现代开发实践——敏捷开发、持续集成 和 持续部署 (CI/CD)、DevOps、多种编程语言——以及 微服务、Docker 容器、Kubernetes 和 无服务器等云原生 技术  功能。因此，他们比以往任何时候都更快地将更多服务推向市场。但在此过程中，他们会如此频繁地在如此多的地方、以如此多的不同语言部署新的应用程序组件，并且部署的时间段差异很大（对于无服务器功能，是几秒钟或几分之一秒），以至于`APM`的每分钟一次数据采样无法跟上步伐；同时网络也在不断发展以跟上现代应用程序的需求，对 NPM 系统提出要求，以扩大在日益混合的云环境中收集性能指标和流的方式，并更加以应用程序为中心。

需要的是更高质量的应用程序遥测——以及更多——可用于为每个应用程序用户请求或事务创建高保真、上下文丰富、完全相关的记录，以及更以应用程序为中心的视图应用程序所依赖的网络。

### 可观测性如何运作？

应用程序可观测性系统通过与应用程序和基础架构组件中内置的现有仪器相集成，并通过提供工具将仪器添加到这些组件，不断发现和收集应用程序性能遥测数据。应用程序可观测性侧重于四种主要遥测类型、可观测性的三大支柱——`Logs`、`Metrics`和`Traces`——以及依赖性。

`Logs`是应用程序事件的精细、带时间戳、完整且不可变的记录，采用三种格式：纯文本、结构化或二进制。除其他事项外，日志可用于创建每个事件的高保真度、逐毫秒的记录，包括周围的上下文，开发人员可以“回放”以进行故障排除和调试。
`Metrics`是给定时间段内应用程序和系统健康状况的基本衡量指标，例如应用程序在五分钟内使用了多少内存或 CPU 容量，或者应用程序在此期间经历了多少延迟使用量激增。
`Traces`记录了每个用户请求的端到端“旅程”，从 UI 或移动应用程序通过整个分布式架构再回到用户。
收集这些遥测数据后，平台实时将其关联起来，为DevOps团队、站点可靠性工程(SRE) 团队、软件工程师和其他 IT 人员提供完整的上下文信息——任何事件的内容、地点和原因可能表明，导致或用于解决应用程序性能问题或收集可操作的见解。

许多应用程序可观测性系统会自动发现系统中可能出现的新遥测来源（例如对另一个软件应用程序的新 API 调用）。由于它们处理的数据比标准 APM 解决方案多得多，因此许多平台都包含 AIOps（运营人工智能）功能，可以从噪音（与问题无关的数据）中筛选出信号——实际问题的迹象。

网络可观测性系统采用类似的方法，通过从混合云环境收集一系列网络性能数据。这些数据包括来自路由器和交换机的指标，有助于了解它们的性能和健康状况，以及用于深入了解通过网络设备运行的应用程序的流数据，以及相关的元数据。

### OpenTelemetry
[`OpenTelemetry`](https://opentelemetry.io/)，也简称为`OTel`，是一个供应商中立、开源的可观测性框架，用于检测、生成、收集和导出遥测数据，如 `Traces`、`Metrics`和`Logs`。作为一项行业标准，它受到许多供应商的原生支持。

![OpenTelemetry](https://s2.loli.net/2022/12/30/UXOLRF91NloYfZS.png)